<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Landing Page Builder</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --bg-dark: #0f172a;
      --bg-darker: #020617;
      --bg-light: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --accent: #3b82f6;
      --accent-hover: #2563eb;
      --border: #334155;
    }
    body { 
      font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; 
      background:var(--bg-darker); 
      color:var(--text-primary); 
      margin: 0;
      padding: 0;
      height:100vh; 
      overflow: hidden;
    }

    .builder-container { 
      display:grid; 
      grid-template-columns:280px 1fr 350px; 
      height:100vh;
      width: 100vw;
    }
    
    .sidebar, .properties-panel { 
      background:var(--bg-dark); 
      padding:1.5rem; 
      overflow-y:auto; 
      height: 100vh;
    }
    .sidebar { border-right:1px solid var(--border); }
    .properties-panel { border-left:1px solid var(--border); }

    .canvas { 
      background:#f9fafb; 
      display:flex; 
      flex-direction:column;
      height: 100vh;
      overflow: hidden;
    }
    
    .canvas-header { 
      background:var(--bg-dark); 
      border-bottom:1px solid var(--border); 
      padding:1rem 2rem; 
      display:flex; 
      justify-content:space-between; 
      align-items:center;
      flex-shrink: 0;
    }
    
    .canvas-header h1 { font-size:1.3rem; color:var(--text-primary); }
    
    .header-actions { display:flex; gap:0.75rem; }

    .btn { 
      padding:0.6rem 1.2rem; 
      border-radius:6px; 
      border:none; 
      cursor:pointer; 
      font-weight:600; 
      transition:all 0.2s; 
      font-size:0.9rem; 
    }
    .btn-primary { background:var(--accent); color:white; }
    .btn-primary:hover { background:var(--accent-hover); }
    .btn-secondary { background:transparent; color:var(--text-primary); border:1px solid var(--border); }
    .btn-secondary:hover { border-color:var(--text-primary); }
    .btn-small { padding:0.4rem 0.8rem; font-size:0.8rem; }

    .preview-area { 
      flex:1; 
      overflow-y:auto; 
      padding:2rem;
      height: 100%;
    }

    #sectionsContainer {
      min-height: 200px;
    }

    .drop-zone { 
      min-height:400px; 
      border:2px dashed var(--border); 
      border-radius:12px; 
      display:flex; 
      flex-direction:column;
      align-items:center; 
      justify-content:center; 
      color:var(--text-secondary); 
    }
    
    .drop-zone h3 { font-size:1.5rem; margin-bottom:0.5rem; }

    .placed-section { 
      position:relative; 
      margin-bottom:1rem; 
      border-radius:8px; 
      overflow:hidden; 
      border:2px solid transparent; 
      cursor:pointer; 
      background:white;
      transition: all 0.2s;
    }
    
    .placed-section:hover { border-color:var(--accent); }
    .placed-section.selected { 
      border-color:var(--accent); 
      box-shadow:0 0 0 3px rgba(59,130,246,0.2); 
    }
    
    .section-controls { 
      position:absolute; 
      top:10px; 
      right:10px; 
      display:flex; 
      gap:0.5rem; 
      opacity:0; 
      transition:opacity 0.2s; 
      z-index:10; 
    }
    
    .placed-section:hover .section-controls { opacity:1; }
    
    .section-controls button { 
      padding:0.5rem 0.8rem; 
      border-radius:6px; 
      background:rgba(0,0,0,0.8); 
      color:white; 
      border:none; 
      cursor:pointer; 
      font-size:0.75rem; 
      font-weight:600; 
    }
    .section-controls button:hover { background:var(--accent); }

    .section-item { 
      background:var(--bg-light); 
      padding:1rem; 
      border-radius:8px; 
      border:2px dashed var(--border); 
      cursor:grab; 
      transition:all 0.2s; 
      user-select:none; 
      margin-bottom:0.75rem; 
    }
    .section-item:hover { 
      border-color:var(--accent); 
      transform:translateX(5px); 
    }
    .section-item:active { cursor:grabbing; }

    .sidebar h2 { 
      font-size:1.1rem; 
      margin-bottom:1rem; 
      color:var(--accent); 
    }

    #projectName { 
      width:100%; 
      padding:0.6rem; 
      background:var(--bg-light); 
      border:1px solid var(--border); 
      border-radius:6px; 
      color:var(--text-primary); 
      margin-bottom:1rem; 
    }

    .template-btn { 
      width:100%; 
      padding:0.8rem; 
      margin-bottom:0.75rem; 
      background:var(--bg-light); 
      border:1px solid var(--border); 
      border-radius:6px; 
      cursor:pointer; 
      text-align:left; 
      color:var(--text-primary);
      transition: all 0.2s;
    }
    .template-btn:hover { 
      border-color:var(--accent); 
      background:rgba(59,130,246,0.1); 
      transform: translateX(5px);
    }
    .template-btn strong { display:block; font-size:1rem; margin-bottom:0.3rem; }
    .template-btn small { color:var(--text-secondary); font-size:0.8rem; }

    .prop-group { margin-bottom:1.5rem; }
    .prop-group label { 
      display:block; 
      font-size:0.9rem; 
      margin-bottom:0.5rem; 
      color:var(--text-secondary); 
      font-weight:600; 
    }
    .prop-group input, .prop-group select, .prop-group textarea { 
      width:100%; 
      padding:0.6rem; 
      background:var(--bg-light); 
      border:1px solid var(--border); 
      border-radius:6px; 
      color:var(--text-primary); 
      font-family:inherit; 
    }
    .prop-group textarea {
      min-height: 150px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      resize: vertical;
    }
    .prop-group input[type="color"] { 
      height:40px; 
      cursor:pointer; 
      padding:0.2rem; 
    }
    .prop-group input[type="file"] {
      padding:0.4rem;
      cursor:pointer;
    }

    .mode-toggle {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      background: var(--bg-light);
      padding: 0.3rem;
      border-radius: 6px;
    }
    .mode-toggle button {
      flex: 1;
      padding: 0.5rem;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.85rem;
    }
    .mode-toggle button.active {
      background: var(--accent);
      color: white;
    }

    .code-editor {
      display: none;
    }
    .code-editor.active {
      display: block;
    }

    [contenteditable="true"]:focus,
    [contenteditable="inherit"]:focus {
      outline: 2px solid var(--accent) !important;
      outline-offset: 2px;
      border-radius: 4px;
      background: rgba(59, 130, 246, 0.05) !important;
    }

    .edit-hint {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid var(--accent);
      padding: 0.75rem;
      border-radius: 6px;
      margin-top: 1rem;
      font-size: 0.85rem;
      color:var(--text-secondary);
    }

    .image-preview {
      width: 100%;
      height: 80px;
      border-radius: 6px;
      margin-top: 0.5rem;
      object-fit: cover;
      border: 1px solid var(--border);
    }

    /* UNIQUE TEMPLATE STYLES */
    
    /* Startup Template - Modern & Clean */
    .startup-hero { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 8rem 2rem;
      text-align: center;
      color: white;
      position: relative;
      overflow: hidden;
    }
    .startup-hero::before {
      content: '';
      position: absolute;
      width: 500px;
      height: 500px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
      top: -250px;
      right: -250px;
    }
    .startup-hero h1 { font-size: 4rem; margin-bottom: 1.5rem; position: relative; z-index: 1; }
    .startup-hero p { font-size: 1.5rem; margin-bottom: 2rem; position: relative; z-index: 1; }
    .startup-cta { 
      display: inline-block;
      padding: 1.2rem 3rem;
      background: white;
      color: #667eea;
      border-radius: 50px;
      font-weight: 700;
      text-decoration: none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    /* Portfolio Template - Dark & Professional */
    .portfolio-hero {
      background: linear-gradient(to right, #000428, #004e92);
      padding: 10rem 2rem;
      text-align: left;
      color: white;
      display: flex;
      align-items: center;
      min-height: 80vh;
    }
    .portfolio-hero-content { max-width: 800px; margin: 0 auto; }
    .portfolio-hero h1 { 
      font-size: 5rem; 
      margin-bottom: 2rem;
      background: linear-gradient(45deg, #ffffff, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .portfolio-hero p { font-size: 1.3rem; color: #94a3b8; margin-bottom: 2rem; }

    /* Agency Template - Bold & Creative */
    .agency-hero {
      background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      padding: 8rem 2rem;
      text-align: center;
      color: #1e293b;
    }
    .agency-hero h1 { 
      font-size: 4.5rem; 
      font-weight: 900;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: -2px;
    }

    /* E-commerce Template - Vibrant & Dynamic */
    .ecommerce-hero {
      background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
      padding: 6rem 2rem;
      color: white;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      align-items: center;
    }
    .ecommerce-hero h1 { font-size: 3.5rem; margin-bottom: 1.5rem; }

    /* App Landing Template - Sleek & Modern */
    .app-hero {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 6rem 2rem;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 90vh;
      text-align: center;
    }
    .app-hero h1 { font-size: 4rem; margin-bottom: 1rem; }

    /* Blog Template - Editorial & Clean */
    .blog-hero {
      background: white;
      padding: 8rem 2rem 4rem;
      text-align: center;
      color: #1e293b;
      border-bottom: 3px solid #e2e8f0;
    }
    .blog-hero h1 { 
      font-size: 3.5rem; 
      font-family: 'Georgia', serif;
      margin-bottom: 1rem;
    }

    @media (max-width:1024px) {
      .builder-container { grid-template-columns:1fr; }
      .sidebar, .properties-panel { display:none; }
    }
  </style>
</head>
<body>
  <div class="builder-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>üìÅ Projects</h2>
      <input type="text" id="projectName" placeholder="My Project" />
      <button class="btn btn-primary" id="saveBtn">Save Project</button>
      
      <h2 style="margin-top:2rem;">üé® Templates</h2>
      <button class="template-btn" data-template="startup">
        <strong>üíº Startup SaaS</strong>
        <small>Modern gradient hero, features, pricing</small>
      </button>
      <button class="template-btn" data-template="portfolio">
        <strong>üë®‚Äçüíª Developer Portfolio</strong>
        <small>Dark theme, project showcase, skills</small>
      </button>
      <button class="template-btn" data-template="agency">
        <strong>üéØ Creative Agency</strong>
        <small>Bold colors, team section, case studies</small>
      </button>
      <button class="template-btn" data-template="ecommerce">
        <strong>üõçÔ∏è E-commerce Store</strong>
        <small>Product grid, vibrant CTAs, testimonials</small>
      </button>
      <button class="template-btn" data-template="app">
        <strong>üì± App Landing</strong>
        <small>Mobile-first, feature showcase, download buttons</small>
      </button>
      <button class="template-btn" data-template="blog">
        <strong>‚úçÔ∏è Blog/Magazine</strong>
        <small>Editorial design, article grid, newsletter</small>
      </button>
      
      <h2 style="margin-top:2rem;">üì¶ Components</h2>
      <div class="section-library">
        <div class="section-item" draggable="true" data-type="hero">üéØ Hero Section</div>
        <div class="section-item" draggable="true" data-type="features">‚ú® Features Grid</div>
        <div class="section-item" draggable="true" data-type="stats">üìä Stats Counter</div>
        <div class="section-item" draggable="true" data-type="pricing">üí∞ Pricing Table</div>
        <div class="section-item" draggable="true" data-type="cta">üöÄ Call to Action</div>
        <div class="section-item" draggable="true" data-type="footer">üìÑ Footer</div>
      </div>
    </div>
    
    <!-- Canvas -->
    <div class="canvas">
      <div class="canvas-header">
        <h1>üé® Advanced Landing Page Builder</h1>
        <div class="header-actions">
          <button class="btn btn-secondary" id="clearBtn">Clear All</button>
          <button class="btn btn-primary" id="exportBtn">üíæ Export HTML</button>
        </div>
      </div>
      <div class="preview-area">
        <div class="drop-zone" id="dropZone">
          <h3>üëà Drag components to start</h3>
          <p>Or load a template from the sidebar</p>
        </div>
        <div id="sectionsContainer"></div>
      </div>
    </div>
    
    <!-- Properties Panel -->
    <div class="properties-panel">
      <h2>‚öôÔ∏è Properties</h2>
      
      <div class="mode-toggle">
        <button class="active" id="visualMode">üé® Visual</button>
        <button id="codeMode">üíª Code</button>
      </div>
      
      <div id="propertiesContent">
        <p style="color:#94a3b8;">Select a section to edit</p>
      </div>
    </div>
  </div>

  <script>
    let sections = [];
    let selectedId = null;
    let editMode = 'visual'; // 'visual' or 'code'

    const templates = {
      hero: {
        html: '<div class="startup-hero"><h1 contenteditable="true">Build Something Amazing</h1><p contenteditable="true">Create stunning landing pages in minutes</p><a href="#" class="startup-cta" contenteditable="true">Get Started Free</a></div>',
        css: '',
        props: {bgType:"gradient", bgStart:"#667eea", bgEnd:"#764ba2", bgImage:""}
      },
      features: {
        html: '<div style="padding:4rem 2rem;background:#f8fafc;"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem;max-width:1200px;margin:0 auto;"><div style="text-align:center;padding:2rem;"><div style="font-size:3rem;margin-bottom:1rem;">‚ö°</div><h3 contenteditable="true">Lightning Fast</h3><p contenteditable="true">Blazing fast performance</p></div><div style="text-align:center;padding:2rem;"><div style="font-size:3rem;margin-bottom:1rem;">üé®</div><h3 contenteditable="true">Beautiful Design</h3><p contenteditable="true">Pixel-perfect interfaces</p></div><div style="text-align:center;padding:2rem;"><div style="font-size:3rem;margin-bottom:1rem;">üì±</div><h3 contenteditable="true">Responsive</h3><p contenteditable="true">Works on all devices</p></div></div></div>',
        css: '',
        props: {bgType:"solid", bgColor:"#f8fafc", bgImage:""}
      },
      stats: {
        html: '<div style="background:#1e293b;padding:4rem 2rem;text-align:center;color:white;"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:3rem;max-width:1000px;margin:0 auto;"><div><h2 contenteditable="true" style="font-size:3rem;color:#3b82f6;margin-bottom:0.5rem;">10K+</h2><p contenteditable="true" style="color:#94a3b8;">Active Users</p></div><div><h2 contenteditable="true" style="font-size:3rem;color:#3b82f6;margin-bottom:0.5rem;">50K+</h2><p contenteditable="true" style="color:#94a3b8;">Pages Created</p></div><div><h2 contenteditable="true" style="font-size:3rem;color:#3b82f6;margin-bottom:0.5rem;">99%</h2><p contenteditable="true" style="color:#94a3b8;">Satisfaction</p></div></div></div>',
        css: '',
        props: {bgType:"solid", bgColor:"#1e293b", bgImage:""}
      },
      pricing: {
        html: '<div style="padding:4rem 2rem;background:white;"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:2rem;max-width:1200px;margin:2rem auto 0;"><div style="border:2px solid #e2e8f0;border-radius:12px;padding:2rem;text-align:center;"><h3 contenteditable="true" style="color:#1e293b;margin-bottom:1rem;">Starter</h3><div contenteditable="true" style="font-size:3rem;font-weight:700;color:#3b82f6;margin-bottom:1rem;">$9</div><p contenteditable="true" style="color:#64748b;">Perfect for getting started</p></div><div style="border:2px solid #3b82f6;border-radius:12px;padding:2rem;text-align:center;box-shadow:0 10px 30px rgba(59,130,246,0.2);"><h3 contenteditable="true" style="color:#1e293b;margin-bottom:1rem;">Pro</h3><div contenteditable="true" style="font-size:3rem;font-weight:700;color:#3b82f6;margin-bottom:1rem;">$29</div><p contenteditable="true" style="color:#64748b;">Most popular choice</p></div><div style="border:2px solid #e2e8f0;border-radius:12px;padding:2rem;text-align:center;"><h3 contenteditable="true" style="color:#1e293b;margin-bottom:1rem;">Enterprise</h3><div contenteditable="true" style="font-size:3rem;font-weight:700;color:#3b82f6;margin-bottom:1rem;">$99</div><p contenteditable="true" style="color:#64748b;">Full power unleashed</p></div></div></div>',
        css: '',
        props: {bgType:"solid", bgColor:"#ffffff", bgImage:""}
      },
      cta: {
        html: '<div style="background:linear-gradient(135deg,#f093fb,#f5576c);padding:5rem 2rem;text-align:center;color:white;"><h2 contenteditable="true" style="font-size:2.5rem;margin-bottom:1rem;">Ready to Get Started?</h2><p contenteditable="true" style="font-size:1.2rem;margin-bottom:2rem;opacity:0.9;">Join thousands building amazing pages</p><a href="#" style="display:inline-block;padding:1rem 2.5rem;background:white;color:#f093fb;border-radius:50px;text-decoration:none;font-weight:700;" contenteditable="true">Start Building Now</a></div>',
        css: '',
        props: {bgType:"gradient", bgStart:"#f093fb", bgEnd:"#f5576c", bgImage:""}
      },
      footer: {
        html: '<div style="background:#0f172a;padding:3rem 2rem;text-align:center;color:#94a3b8;"><p contenteditable="true">&copy; 2025 Your Company. Built with Landing Page Builder</p></div>',
        css: '',
        props: {bgType:"solid", bgColor:"#0f172a", bgImage:""}
      }
    };

    const presets = {
      startup: [
        {type:"hero", html:'<div class="startup-hero"><h1 contenteditable="true">Launch Your Startup Faster</h1><p contenteditable="true">The all-in-one platform for modern SaaS companies</p><a href="#" class="startup-cta" contenteditable="true">Start Free Trial</a></div>'},
        {type:"features"},
        {type:"pricing"},
        {type:"cta", customProps:{bgStart:"#4facfe", bgEnd:"#00f2fe"}},
        {type:"footer"}
      ],
      portfolio: [
        {type:"hero", html:'<div class="portfolio-hero"><div class="portfolio-hero-content"><h1 contenteditable="true">John Doe</h1><p contenteditable="true">Full-Stack Developer & Designer crafting beautiful digital experiences</p><a href="#" style="display:inline-block;padding:1rem 2rem;background:#00d4ff;color:#000428;border-radius:6px;text-decoration:none;font-weight:700;margin-top:1rem;" contenteditable="true">View My Work</a></div></div>'},
        {type:"features", customProps:{bgColor:"#020617"}},
        {type:"stats", customProps:{bgColor:"#0f172a"}},
        {type:"footer", customProps:{bgColor:"#000000"}}
      ],
      agency: [
        {type:"hero", html:'<div class="agency-hero"><h1 contenteditable="true">WE CREATE BRANDS</h1><p contenteditable="true" style="font-size:1.5rem;max-width:800px;margin:0 auto 2rem;">Award-winning creative agency specializing in brand identity and digital experiences</p><a href="#" style="display:inline-block;padding:1.2rem 3rem;background:#1e293b;color:white;border-radius:50px;text-decoration:none;font-weight:700;" contenteditable="true">See Our Work</a></div>'},
        {type:"features", customProps:{bgColor:"#1e293b"}},
        {type:"stats", customProps:{bgColor:"#fee140"}},
        {type:"cta", customProps:{bgStart:"#a8edea", bgEnd:"#fed6e3"}},
        {type:"footer"}
      ],
      ecommerce: [
        {type:"hero", html:'<div class="ecommerce-hero"><div><h1 contenteditable="true">Shop The Latest Collection</h1><p contenteditable="true" style="font-size:1.3rem;margin-bottom:2rem;">Discover trendsetting fashion at unbeatable prices</p><a href="#" style="display:inline-block;padding:1.2rem 3rem;background:white;color:#ee0979;border-radius:50px;text-decoration:none;font-weight:700;" contenteditable="true">Shop Now</a></div><div style="background:rgba(255,255,255,0.2);border-radius:12px;height:300px;"></div></div>'},
        {type:"features", customProps:{bgColor:"#ffffff"}},
        {type:"pricing"},
        {type:"cta"},
        {type:"footer"}
      ],
      app: [
        {type:"hero", html:'<div class="app-hero"><div><h1 contenteditable="true">Your App, Anywhere</h1><p contenteditable="true" style="font-size:1.3rem;margin-bottom:2rem;max-width:600px;margin:0 auto 2rem;">Download our mobile app and experience the future</p><div style="display:flex;gap:1rem;justify-content:center;"><a href="#" style="padding:1rem 2rem;background:#000;color:white;border-radius:12px;text-decoration:none;font-weight:600;" contenteditable="true">üì± App Store</a><a href="#" style="padding:1rem 2rem;background:#000;color:white;border-radius:12px;text-decoration:none;font-weight:600;" contenteditable="true">ü§ñ Google Play</a></div></div></div>'},
        {type:"features"},
        {type:"stats"},
        {type:"footer"}
      ],
      blog: [
        {type:"hero", html:'<div class="blog-hero"><h1 contenteditable="true">The Creative Journal</h1><p contenteditable="true" style="font-size:1.2rem;color:#64748b;max-width:600px;margin:0 auto;">Stories, insights, and inspiration from our team</p></div>'},
        {type:"features", html:'<div style="padding:4rem 2rem;background:white;"><div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;max-width:1200px;margin:0 auto;"><div style="border-radius:12px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.1);"><div style="height:200px;background:linear-gradient(135deg,#667eea,#764ba2);"></div><div style="padding:1.5rem;"><h3 contenteditable="true" style="color:#1e293b;margin-bottom:0.5rem;">Featured Article</h3><p contenteditable="true" style="color:#64748b;">Discover the latest trends...</p></div></div><div style="border-radius:12px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.1);"><div style="height:200px;background:linear-gradient(135deg,#f093fb,#f5576c);"></div><div style="padding:1.5rem;"><h3 contenteditable="true" style="color:#1e293b;margin-bottom:0.5rem;">Popular Post</h3><p contenteditable="true" style="color:#64748b;">Explore creative solutions...</p></div></div></div></div>'},
        {type:"cta", customProps:{bgStart:"#141e30", bgEnd:"#243b55"}},
        {type:"footer", customProps:{bgColor:"#1e293b"}}
      ]
    };

    function render() {
      const container = document.getElementById("sectionsContainer");
      const dropZone = document.getElementById("dropZone");
      
      if (sections.length === 0) {
        container.innerHTML = "";
        dropZone.style.display = "flex";
        return;
      }
      
      dropZone.style.display = "none";
      
      container.innerHTML = sections.map((sec, i) => 
        '<div class="placed-section ' + (selectedId === sec.id ? 'selected' : '') + '" data-id="' + sec.id + '"><div class="section-controls"><button data-action="code" data-index="' + i + '">üíª</button><button data-action="up" data-index="' + i + '">‚Üë</button><button data-action="down" data-index="' + i + '">‚Üì</button><button data-action="delete" data-index="' + i + '">√ó</button></div><div class="section-content">' + sec.html + '</div></div>'
      ).join("");
      
      sections.forEach(function(sec) {
        updateSectionStyle(sec);
        if (sec.css) {
          applySectionCSS(sec);
        }
      });

      document.querySelectorAll('.placed-section').forEach(function(el) {
        el.addEventListener('click', function(e) {
          if (!e.target.closest('.section-controls') && !e.target.contentEditable) {
            selectSection(parseInt(this.dataset.id));
          }
        });
      });
      
      document.querySelectorAll('.section-controls button').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const action = this.dataset.action;
          const index = parseInt(this.dataset.index);
          
          if (action === 'code') {
            selectSection(sections[index].id);
            editMode = 'code';
            document.getElementById('codeMode').click();
          } else if (action === 'up' && index > 0) {
            const temp = sections[index-1];
            sections[index-1] = sections[index];
            sections[index] = temp;
            render();
          } else if (action === 'down' && index < sections.length - 1) {
            const temp = sections[index];
            sections[index] = sections[index+1];
            sections[index+1] = temp;
            render();
          } else if (action === 'delete') {
            sections.splice(index, 1);
            selectedId = null;
            render();
            showProps();
          }
        });
      });

      document.querySelectorAll('[contenteditable="true"]').forEach(function(el) {
        el.addEventListener('blur', function() {
          const section = this.closest('.placed-section');
          if (section) {
            const sec = sections.find(function(s) { return s.id == section.dataset.id; });
            if (sec) {
              sec.html = section.querySelector('.section-content').innerHTML;
            }
          }
        });
      });

      document.querySelectorAll('.placed-section').forEach(function(section) {
        section.addEventListener('dblclick', function(e) {
          if (e.target.closest('.section-controls')) return;
          
          const target = e.target;
          if (!target.contentEditable || target.contentEditable === 'inherit') {
            target.contentEditable = 'true';
            target.focus();
            
            const range = document.createRange();
            range.selectNodeContents(target);
            const sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
            
            target.addEventListener('blur', function() {
              this.contentEditable = 'inherit';
              const section = this.closest('.placed-section');
              if (section) {
                const sec = sections.find(function(s) { return s.id == section.dataset.id; });
                if (sec) {
                  sec.html = section.querySelector('.section-content').innerHTML;
                }
              }
            }, { once: true });
          }
        });
      });
    }

    function selectSection(id) {
      selectedId = id;
      render();
      showProps();
    }

    function showProps() {
      const sec = sections.find(function(s) { return s.id === selectedId; });
      const propsDiv = document.getElementById("propertiesContent");
      
      if (!sec) {
        propsDiv.innerHTML = "<p style='color:#94a3b8;'>Select a section to edit</p>";
        return;
      }
      
      if (editMode === 'code') {
        showCodeEditor(sec);
      } else {
        showVisualEditor(sec);
      }
    }

    function showVisualEditor(sec) {
      const propsDiv = document.getElementById("propertiesContent");
      let html = '<h3 style="margin-bottom:1.5rem;color:#3b82f6;">Visual Editor</h3>';
      
      html += '<div class="prop-group"><label>Background Type</label><select id="bgType"><option value="solid"' + (sec.props.bgType === 'solid' ? ' selected' : '') + '>Solid Color</option><option value="gradient"' + (sec.props.bgType === 'gradient' ? ' selected' : '') + '>Gradient</option><option value="image"' + (sec.props.bgType === 'image' ? ' selected' : '') + '>Image</option></select></div>';
      
      html += '<div id="colorControls"></div>';
      
      html += '<div class="prop-group"><label>Background Image</label><input type="file" id="bgImage" accept="image/*"><small style="color:#64748b;display:block;margin-top:0.5rem;">Upload background image</small>';
      if (sec.props.bgImage) {
        html += '<img src="' + sec.props.bgImage + '" class="image-preview" />';
      }
      html += '</div>';
      
      html += '<div class="edit-hint">üí° <strong>Double-click</strong> any element to edit<br>üíª Click the <strong>Code button</strong> (üíª) for advanced editing</div>';
      
      propsDiv.innerHTML = html;
      
      updateColorControls(sec);
      
      document.getElementById('bgType').addEventListener('change', function(e) {
        sec.props.bgType = e.target.value;
        updateColorControls(sec);
        updateSectionStyle(sec);
      });
      
      document.getElementById('bgImage').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            sec.props.bgImage = event.target.result;
            updateSectionStyle(sec);
            showProps();
          };
          reader.readAsDataURL(file);
        }
      });
    }

    function showCodeEditor(sec) {
      const propsDiv = document.getElementById("propertiesContent");
      let html = '<h3 style="margin-bottom:1.5rem;color:#3b82f6;">Code Editor</h3>';
      
      html += '<div class="prop-group"><label>HTML</label><textarea id="htmlCode">' + sec.html.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</textarea></div>';
      
      html += '<div class="prop-group"><label>Custom CSS (optional)</label><textarea id="cssCode" placeholder=".my-class { color: red; }">' + (sec.css || '') + '</textarea></div>';
      
      html += '<button class="btn btn-primary" style="width:100%;margin-bottom:1rem;" id="applyCode">‚úÖ Apply Changes</button>';
      
      html += '<div class="edit-hint">‚ö†Ô∏è <strong>Warning:</strong> Editing code directly. Make sure your HTML is valid!</div>';
      
      propsDiv.innerHTML = html;
      
      document.getElementById('applyCode').addEventListener('click', function() {
        const htmlCode = document.getElementById('htmlCode').value;
        const cssCode = document.getElementById('cssCode').value;
        
        sec.html = htmlCode.replace(/&lt;/g, '<').replace(/&gt;/g, '>');
        sec.css = cssCode;
        
        render();
        showProps();
        alert('‚úÖ Code applied successfully!');
      });
    }

    function updateColorControls(sec) {
      const container = document.getElementById('colorControls');
      let html = '';
      
      if (sec.props.bgType === 'solid') {
        html = '<div class="prop-group"><label>Background Color</label><input type="color" value="' + (sec.props.bgColor || '#ffffff') + '" id="bgColor"></div>';
      } else if (sec.props.bgType === 'gradient') {
        html = '<div class="prop-group"><label>Gradient Start</label><input type="color" value="' + (sec.props.bgStart || '#667eea') + '" id="bgStart"></div>';
        html += '<div class="prop-group"><label>Gradient End</label><input type="color" value="' + (sec.props.bgEnd || '#764ba2') + '" id="bgEnd"></div>';
      }
      
      container.innerHTML = html;
      
      if (sec.props.bgType === 'solid') {
        document.getElementById('bgColor').addEventListener('input', function(e) {
          sec.props.bgColor = e.target.value;
          updateSectionStyle(sec);
        });
      } else if (sec.props.bgType === 'gradient') {
        document.getElementById('bgStart').addEventListener('input', function(e) {
          sec.props.bgStart = e.target.value;
          updateSectionStyle(sec);
        });
        document.getElementById('bgEnd').addEventListener('input', function(e) {
          sec.props.bgEnd = e.target.value;
          updateSectionStyle(sec);
        });
      }
    }

    function updateSectionStyle(sec) {
      const el = document.querySelector('[data-id="' + sec.id + '"] .section-content > div');
      if (!el) return;
      
      if (sec.props.bgType === 'image' && sec.props.bgImage) {
        el.style.backgroundImage = 'url(' + sec.props.bgImage + ')';
        el.style.backgroundSize = 'cover';
        el.style.backgroundPosition = 'center';
      } else if (sec.props.bgType === 'gradient') {
        el.style.backgroundImage = 'linear-gradient(135deg, ' + (sec.props.bgStart || '#667eea') + ', ' + (sec.props.bgEnd || '#764ba2') + ')';
      } else {
        el.style.background = sec.props.bgColor || '#ffffff';
        el.style.backgroundImage = 'none';
      }
    }

    function applySectionCSS(sec) {
      let styleEl = document.getElementById('section-css-' + sec.id);
      if (!styleEl) {
        styleEl = document.createElement('style');
        styleEl.id = 'section-css-' + sec.id;
        document.head.appendChild(styleEl);
      }
      styleEl.textContent = '[data-id="' + sec.id + '"] { ' + sec.css + ' }';
    }

    function addSection(type, customHTML, customProps) {
      const template = templates[type];
      const html = customHTML || template.html;
      const props = customProps ? Object.assign({}, template.props, customProps) : JSON.parse(JSON.stringify(template.props));
      sections.push({
        id: Date.now() + Math.random(),
        html: html,
        css: template.css || '',
        props: props
      });
      render();
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('visualMode').addEventListener('click', function() {
        editMode = 'visual';
        this.classList.add('active');
        document.getElementById('codeMode').classList.remove('active');
        showProps();
      });

      document.getElementById('codeMode').addEventListener('click', function() {
        editMode = 'code';
        this.classList.add('active');
        document.getElementById('visualMode').classList.remove('active');
        showProps();
      });

      document.querySelectorAll('.section-item').forEach(function(item) {
        item.addEventListener('dragstart', function(e) {
          e.dataTransfer.setData('type', this.dataset.type);
        });
      });
      
      const dropZone = document.getElementById('dropZone');
      const container = document.getElementById('sectionsContainer');
      
      [dropZone, container].forEach(function(zone) {
        zone.addEventListener('dragover', function(e) {
          e.preventDefault();
        });
        
        zone.addEventListener('drop', function(e) {
          e.preventDefault();
          const type = e.dataTransfer.getData('type');
          if (type) {
            addSection(type);
          }
        });
      });
      
      document.querySelectorAll('.template-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          if (confirm('Load template? This will replace your current page.')) {
            const templateName = this.dataset.template;
            sections = presets[templateName].map(function(item, i) {
              const template = templates[item.type];
              const html = item.html || template.html;
              const props = item.customProps ? Object.assign({}, template.props, item.customProps) : JSON.parse(JSON.stringify(template.props));
              return {
                id: Date.now() + i + Math.random(),
                html: html,
                css: template.css || '',
                props: props
              };
            });
            selectedId = null;
            render();
            showProps();
          }
        });
      });
      
      document.getElementById('clearBtn').addEventListener('click', function() {
        if (confirm('Clear all sections?')) {
          sections = [];
          selectedId = null;
          render();
          showProps();
        }
      });
      
      document.getElementById('exportBtn').addEventListener('click', function() {
        const styles = document.querySelector('style').textContent;
        const htmlContent = sections.map(function(s) { return s.html; }).join('\n');
        const customCSS = sections.map(function(s) { return s.css || ''; }).filter(function(c) { return c; }).join('\n');
        
        const html = '<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>My Landing Page</title>\n  <style>\n    * { margin:0; padding:0; box-sizing:border-box; }\n    body { font-family: -apple-system,BlinkMacSystemFont,\'Segoe UI\',Roboto,sans-serif; }\n    ' + styles + '\n    ' + customCSS + '\n  </style>\n</head>\n<body>\n' + htmlContent + '\n</body>\n</html>';
        
        const blob = new Blob([html], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'landing-page.html';
        a.click();
        URL.revokeObjectURL(url);
        alert('‚úÖ HTML exported with custom code! Check your downloads.');
      });
      
      document.getElementById('saveBtn').addEventListener('click', function() {
        const name = document.getElementById('projectName').value || 'My Project';
        localStorage.setItem('lpb_' + name, JSON.stringify(sections));
        alert('‚úÖ Project saved as: ' + name);
      });
      
      render();
    });
  </script>
</body>
</html>
